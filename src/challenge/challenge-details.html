<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="challenge-details">
  <template>
    <style>
    paper-input {
      --paper-input-container-input: {
        font-size: 4rem;
      };
    }
    paper-button.danger {
      background-color: var(--paper-red-600);
      color: var(--text-primary-color);
    }
    </style>
    <firebase-document
      id="fb"
      data="{{challenge}}"
      path="/users/[[userUid]]/challenges/[[challengeUid]]">
    </firebase-document>
    <h1>[[challenge.player1Uid]] : [[challenge.player2Uid]]</h1>
    <paper-input
      type="number"
      min="0"
      max="21"
      label="Final Score"
      value="{{challenge.player1Score}}">
    </paper-input>
    <paper-input
      type="number"
      min="0"
      max="21"
      label="Final Score"
      value="{{challenge.player2Score}}">
    </paper-input>

    <paper-button class="danger" on-tap="_reject" hidden="[[!_canReject]]">Reject</paper-button>
    <paper-button on-tap="_accept" disabled="[[_accepted]]">Accept Score</paper-button>
  </template>
  <script>
    class ChallengeDetails extends Polymer.Element {
      static get is() { return 'challenge-details'; }
      static get properties() {
        return {
          _accepted: {
            type: Boolean,
            computed: '_computedAccepted(userUid, challenge.*)'
          },
          _canReject: {
            type: Boolean,
            computed: '_computedCanReject(userUid, challenge)'
          }
        };
      }
      _accept(){
        if(this.userUid == this.challenge.player1Uid)
          this.set('challenge.player1Accepted', true);
        else
          this.set('challenge.player2Accepted', true);
      }
      _computedAccepted(userUid){
        if(!userUid || !this.challenge) return;
        if(userUid == this.challenge.player1Uid)
          return this.challenge.player1Accepted;
        return this.challenge.player2Accepted
      }
      _computedCanReject(userUid, challenge) {
        if(!userUid || !challenge) return;
        return userUid == this.challenge.player2Uid;
      }
    }

    window.customElements.define(ChallengeDetails.is, ChallengeDetails);
  </script>
</dom-module>
